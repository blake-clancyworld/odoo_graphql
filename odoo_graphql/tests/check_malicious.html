<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Alpine.js</title>
    <link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous"
    />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.2.3/cdn.js"
        integrity="sha512-tdHUxNPB3/bSr3K5olp0biuy8ztGo8r1INBxtMCP4qOUzeRPuqkcebuUKthZ43WceXnNY+ATvHDWGrWqrZwJ2g=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
        defer
    ></script>
  </head>
  <body>
    <script src="libs/graphql.js"></script> 
    <script>
        const url = "http://192.168.1.113:8100";
        const odoo = odoo_builder(url, "graphql");

        async function getTickets(variables) {
            let data = await odoo.graphql(`
                query Tickets {
                    HelpdeskTicket(domain: $domain, limit: $limit) {	
                        name
                        description
                        user: user_id @include(if: $user_info) {
                            name
                        }
                        stage_id {
                            name
                        }
                        partner_id @include(if: $partner_id)  {
                            image: image_1920 @include(if: $image)
                            user_id {
                                name
                            }
                        }
                    }
                }`,
                Object.assign({}, {domain: [], user_info: true, partner_id: false, image: false}, variables)
            );
            let res = data && data['HelpdeskTicket'] || [];
            return res;
        };
        /*
            Examples:
            tickets = await getTickets()
            tickets = await getTickets({limit: 200, offset: 400, partner_id: true})
        */

        async function odoo_login(login, password) {
            let data = await odoo.login(login, password);
            Alpine.store("user", data || {});
        }
        async function odoo_logout() {
            odoo.logout();
            Alpine.store("user", {});
        }
    </script>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
            </ul>
            <template x-data x-if="$store.user">
                <div x-text="$store.user.name"></div>
            </template>
        </div>
    </nav>
    <div x-data="{login: '', password: ''}">
        <input type="text" x-model="login"/>
        <input type="password" x-model="password"/>
        <button @click="odoo_login(login, password)">Login</button>
        <button @click="odoo_logout()">Log out</button>
    </div>
    <div x-data="{data: ''}">
        <button @click="odoo.session()">Get session</button>
        <div type="text" x-text="data"></div>
    </div>
    

  </body>
  <script>
    document.addEventListener('alpine:init', async () => {
        Alpine.store('darkMode', {
            on: false,

            toggle() {
                this.on = ! this.on
            }
        })
        let data = await odoo.session();
        Alpine.store("user", data || {});
    })
</script>
</html>